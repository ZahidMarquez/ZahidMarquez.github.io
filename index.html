<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lista de Espera Interactiva</title>

<!-- SheetJS para exportar Excel -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: linear-gradient(135deg, #c7f0f9, #fdd6e3);
    color: #222;
}

h2, h3 {
    text-align: center;
    color: #222;
}

input, button, select {
    margin: 5px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    color: #222;
}

input:focus, select:focus {
    outline: none;
    border-color: #8ecae6;
    box-shadow: 0 0 5px rgba(142,202,230,0.5);
}

button {
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    margin: 10px 0;
    padding: 15px 20px;
    border-radius: 10px;
    color: #222;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    transition: transform 0.2s;
}

li:hover { transform: translateY(-2px); }

/* Botones pastel */
.btn-llamar {
    margin-left: 10px;
    background: #a8dadc;
    color: #222;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
}

.btn-llamar:hover { background: #89c2d9; }

.btn-stop {
    margin-left: 10px;
    background: #ffb5a7;
    color: #222;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
}

.btn-stop:hover { background: #ff928b; }

/* Colores pastel por tipo de pasajero */
li.aeromexico { background: #a8dadc; }
li.platinum { background: #d6cadd; }
li.centurion { background: #ffd6a5; }

/* Resaltado para llamado activo */
li.llamando {
    border: 3px solid #ffeb3b;
    box-shadow: 0 0 15px #ffeb3b;
}

/* Tabla historial */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
    color: #222;
}

button.borrar, button.exportar {
    background: #ffd6a5;
    color: #222;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
}

button.borrar:hover, button.exportar:hover {
    background: #ffb05a;
}
</style>
</head>

<body>

<h2>üìã Lista de Espera ‚úàÔ∏è</h2>

<div style="text-align:center;">
<input type="text" id="nombre" placeholder="Nombre del pasajero">
<input type="number" id="pasajeros" placeholder="N√∫mero de pasajeros" min="1">
<select id="tipo">
  <option value="Aeromexico">Aeromexico</option>
  <option value="Platinum">Platinum</option>
  <option value="Centurion">Centurion</option>
</select>
<br>
<button id="btnAgregar">Agregar</button>
<button id="btnPantalla">üì∫ Pantalla</button>
</div>

<h3>Pasajeros en espera:</h3>
<ul id="lista"></ul>

<h3>Registro hist√≥rico:</h3>
<ul id="historial"></ul>

<h3>Total de personas registradas: <span id="total">0</span></h3>

<h3>Contador por categor√≠as:</h3>
<ul>
  <li><strong>Aeromexico:</strong> <span id="cont-aero">0</span></li>
  <li><strong>Platinum:</strong> <span id="cont-plat">0</span></li>
  <li><strong>Centurion:</strong> <span id="cont-cent">0</span></li>
</ul>

<button class="borrar" onclick="borrarHistorial()">üóëÔ∏è Borrar historial</button>
<button class="exportar" onclick="exportarExcel()">üíæ Exportar a Excel</button>

<audio id="sonidoLlamado" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// VARIABLES & STORAGE
let totalPersonas = Number(localStorage.getItem("totalPersonas")) || 0;
let historial = JSON.parse(localStorage.getItem("historial")) || [];
let listaEspera = JSON.parse(localStorage.getItem("listaEspera")) || [];
let codigoCounter = Number(localStorage.getItem("codigoCounter")) || 1;

document.getElementById("total").textContent = totalPersonas;
renderLista();
renderHistorial();
actualizarContadores();

// AGREGAR A LISTA DE ESPERA
document.getElementById("btnAgregar").addEventListener("click", () => {
    const nombre = document.getElementById("nombre").value.trim();
    const pasajeros = Number(document.getElementById("pasajeros").value);
    const tipo = document.getElementById("tipo").value;

    if (!nombre || pasajeros <= 0) { 
        alert("Por favor ingrese un nombre v√°lido y n√∫mero de pasajeros."); 
        return; 
    }

    const codigo = "AE-" + codigoCounter.toString().padStart(4,"0");
    codigoCounter++;
    localStorage.setItem("codigoCounter", codigoCounter);

    const horaRegistro = new Date().toLocaleString();

    const pasajero = { codigo, nombre, pasajeros, tipo, horaRegistro };
    listaEspera.push(pasajero);
    localStorage.setItem("listaEspera", JSON.stringify(listaEspera));

    totalPersonas += pasajeros;
    localStorage.setItem("totalPersonas", totalPersonas);
    document.getElementById("total").textContent = totalPersonas;

    renderLista();

    document.getElementById("nombre").value = "";
    document.getElementById("pasajeros").value = "";
});

// LLAMAR PASAJERO
function llamarPasajero(codigo){
    const pas = listaEspera.find(p => p.codigo === codigo);
    if (!pas) return;

    localStorage.setItem("llamadaActiva", JSON.stringify(pas));
    localStorage.setItem("actualizarPantalla", Date.now());

    document.getElementById("sonidoLlamado").play();

    renderLista();
}

// DEJAR DE LLAMAR
function detenerLlamada(codigo){
    const idx = listaEspera.findIndex(p => p.codigo === codigo);
    if (idx < 0) return;

    const pas = listaEspera[idx];

    listaEspera.splice(idx, 1);
    localStorage.setItem("listaEspera", JSON.stringify(listaEspera));

    historial.push({...pas, horaLlamado: new Date().toLocaleString()});
    localStorage.setItem("historial", JSON.stringify(historial));

    totalPersonas -= Number(pas.pasajeros);
    localStorage.setItem("totalPersonas", totalPersonas);
    document.getElementById("total").textContent = totalPersonas;

    localStorage.setItem("llamadaActiva", "null");
    localStorage.setItem("actualizarPantalla", Date.now());

    renderLista();
    renderHistorial();
    actualizarContadores();
}

// RENDER LISTA DE ESPERA
function renderLista(){
    const ul = document.getElementById("lista");
    ul.innerHTML = "";

    const llamadaActiva = JSON.parse(localStorage.getItem("llamadaActiva"));

    listaEspera.forEach(p => {
        const li = document.createElement("li");

        li.className = p.tipo.toLowerCase(); 

        if (llamadaActiva && llamadaActiva.codigo === p.codigo)
            li.classList.add("llamando");

        li.innerHTML = `<strong>${p.codigo}</strong> ‚Äî ${p.nombre} ‚Äî ${p.pasajeros} pax ‚Äî <em>${p.tipo}</em>`;

        const btnCall = document.createElement("button");
        btnCall.textContent = "Llamar";
        btnCall.className = "btn-llamar";
        btnCall.onclick = () => llamarPasajero(p.codigo);

        const btnStop = document.createElement("button");
        btnStop.textContent = "Dejar de llamar";
        btnStop.className = "btn-stop";
        btnStop.onclick = () => detenerLlamada(p.codigo);

        li.append(btnCall, btnStop);
        ul.appendChild(li);
    });
}

// RENDER HISTORIAL
function renderHistorial(){
    const cont = document.getElementById("historial");
    cont.innerHTML = "";

    historial.forEach(h => {
        const li = document.createElement("li");
        li.innerHTML = `
            <strong>${h.codigo}</strong> ‚Äî ${h.nombre} ‚Äî ${h.pasajeros} pax ‚Äî <em>${h.tipo}</em><br>
            <small>Registrado: ${h.horaRegistro} | Llamado: ${h.horaLlamado}</small>
        `;
        cont.appendChild(li);
    });
}

// CONTADORES POR CATEGOR√çA
function actualizarContadores(){
    let aero=0, plat=0, cent=0;

    historial.forEach(h => {
        if (h.tipo === "Aeromexico") aero += Number(h.pasajeros);
        if (h.tipo === "Platinum")  plat += Number(h.pasajeros);
        if (h.tipo === "Centurion") cent += Number(h.pasajeros);
    });

    document.getElementById("cont-aero").textContent = aero;
    document.getElementById("cont-plat").textContent = plat;
    document.getElementById("cont-cent").textContent = cent;
}

// BORRAR HISTORIAL
function borrarHistorial(){
    if (!confirm("¬øSeguro que deseas borrar el historial?")) return;
    historial = [];
    localStorage.setItem("historial", "[]");
    actualizarContadores();
    renderHistorial();
}

// EXPORTAR A EXCEL
function exportarExcel() {
    if(historial.length === 0){
        alert("No hay datos para exportar.");
        return;
    }

    const ws_data = historial.map(h => ({
        C√≥digo: h.codigo,
        Nombre: h.nombre,
        Pasajeros: h.pasajeros,
        Tipo: h.tipo,
        "Hora Registro": h.horaRegistro,
        "Hora Llamado": h.horaLlamado
    }));

    const ws = XLSX.utils.json_to_sheet(ws_data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Historial");

    const fecha = new Date().toISOString().slice(0,10);
    XLSX.writeFile(wb, `historial_lista_espera_${fecha}.xlsx`);
}

// PANTALLA SECUNDARIA
document.getElementById("btnPantalla").addEventListener("click", () => {
    window.open("pantalla.html", "_blank");
});
</script>

</body>
</html>
