
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lista de Espera VIP ¬∑ Tablet</title>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
:root{
 --bg:#f2f4f8; --card:#fff; --text:#222;
 --btn:#1e88e5;
}
body.dark{
 --bg:#0f2027; --card:#203a43; --text:#f1f1f1;
}
*{box-sizing:border-box}
body{
 margin:0;
 padding:16px;
 font-family:system-ui,Arial,sans-serif;
 background:var(--bg);
 color:var(--text);
 touch-action:manipulation;
}

h2,h3{text-align:center;margin:12px 0}

.section{
 background:var(--card);
 padding:16px;
 border-radius:18px;
 margin-bottom:16px;
}

input,select,button{
 width:100%;
 padding:16px;
 margin:8px 0;
 border-radius:18px;
 border:none;
 font-size:18px;
}

button{
 font-weight:700;
 background:var(--btn);
 color:white;
 cursor:pointer;
}

button:active{transform:scale(.97)}

.row{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:10px;
}

ul{list-style:none;padding:0;margin:0}

li{
 margin:10px 0;
 padding:14px;
 border-radius:18px;
 display:flex;
 flex-direction:column;
 gap:10px;
}

.centurion{background:#ffe4b5}
.platinum{background:#e0d7f5}
.aeromexico{background:#cce5e8}

.actions{
 display:grid;
 grid-template-columns:1fr 1fr 1fr;
 gap:10px;
}

.btn-llamar{background:#219ebc}
.btn-fin{background:#2a9d8f}
.btn-ret{background:#e63946}

.small{font-size:14px;opacity:.7}
.total{font-size:22px;font-weight:700;text-align:center}
</style>
</head>

<body>

<h2>‚úà Lista de Espera VIP</h2>

<div class="section">
 <input id="nombre" placeholder="Nombre">
 <input id="pasajeros" type="number" min="1" placeholder="Pasajeros">
 <select id="tipo">
  <option>Centurion</option>
  <option>Platinum</option>
  <option>Aeromexico</option>
 </select>

 <div class="row">
  <button onclick="agregar()">‚ûï Agregar</button>
  <button onclick="toggleDark()">üåô Modo</button>
 </div>

 <label class="small">
  <input type="checkbox" id="chkTicket"> üñ®Ô∏è Imprimir ticket
 </label>
</div>

<div class="section">
 <h3>En espera</h3>
 <ul id="lista"></ul>
 <div class="total">Total personas: <span id="total">0</span></div>
</div>

<div class="section">
 <h3>Historial</h3>
 <ul id="historial"></ul>
 <div class="small">‚è± Promedio espera: <span id="promedio">0</span> min</div>
 <button onclick="exportarExcel()">üìä Exportar Excel</button>
</div>

<audio id="sonido" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let lista=JSON.parse(localStorage.getItem("lista"))||[];
let historial=JSON.parse(localStorage.getItem("historial"))||[];
let contador=Number(localStorage.getItem("contador"))||1;
let dark=localStorage.getItem("dark")==="1";

const jerarquia={Centurion:1,Platinum:2,Aeromexico:3};
if(dark)document.body.classList.add("dark");

function guardar(){
 localStorage.setItem("lista",JSON.stringify(lista));
 localStorage.setItem("historial",JSON.stringify(historial));
 localStorage.setItem("contador",contador);
 localStorage.setItem("dark",dark?1:0);
}

function agregar(){
 const nombre=document.getElementById("nombre").value.trim();
 const pasajeros=Number(document.getElementById("pasajeros").value);
 const tipo=document.getElementById("tipo").value;

 if(!nombre||pasajeros<=0) return alert("Datos inv√°lidos");

 const p={
  codigo:`AE-${String(contador++).padStart(4,"0")}`,
  nombre,pasajeros,tipo,
  horaRegistro:Date.now()
 };

 lista.push(p);
 guardar();
 render();

 if(document.getElementById("chkTicket").checked) imprimirTicket(p);

 document.getElementById("nombre").value="";
 document.getElementById("pasajeros").value="";
}

function llamar(c){
 const p=lista.find(x=>x.codigo===c);
 if(!p)return;
 p.horaLlamado=Date.now();
 document.getElementById("sonido").play();
}

function mover(c,ret){
 const i=lista.findIndex(x=>x.codigo===c);
 if(i<0)return;
 const p=lista.splice(i,1)[0];
 p.retirado=ret;
 p.horaLlamado=p.horaLlamado||Date.now();
 historial.unshift(p);
 guardar();render();
}

function render(){
 lista.sort((a,b)=>jerarquia[a.tipo]-jerarquia[b.tipo]||a.horaRegistro-b.horaRegistro);

 const ul=document.getElementById("lista");
 ul.innerHTML="";
 let total=0;

 lista.forEach(p=>{
  total+=p.pasajeros;
  const li=document.createElement("li");
  li.className=p.tipo.toLowerCase();
  li.innerHTML=`
   <strong>${p.codigo}</strong>
   ${p.nombre} ¬∑ ${p.pasajeros} pax
   <div class="actions">
    <button class="btn-llamar" onclick="llamar('${p.codigo}')">Llamar</button>
    <button class="btn-fin" onclick="mover('${p.codigo}',false)">Finalizar</button>
    <button class="btn-ret" onclick="mover('${p.codigo}',true)">Retirado</button>
   </div>
  `;
  ul.appendChild(li);
 });

 document.getElementById("total").textContent=total;

 const h=document.getElementById("historial");
 h.innerHTML="";
 historial.forEach(p=>{
  const li=document.createElement("li");
  li.textContent=`${p.codigo} ${p.nombre} (${p.pasajeros}) ${p.retirado?"‚ùå":""}`;
  h.appendChild(li);
 });

 calcularPromedio();
}

function calcularPromedio(){
 const t=historial.map(p=>(p.horaLlamado-p.horaRegistro)/60000);
 document.getElementById("promedio").textContent=
  t.length?Math.round(t.reduce((a,b)=>a+b,0)/t.length):0;
}

function imprimirTicket(p){
 const w=window.open("","PRINT","width=300,height=600");
 w.document.write(`
 <body style="font-family:Arial;text-align:center;width:80mm">
 <h2>${p.codigo}</h2>
 <div>${p.nombre}</div>
 <div>${p.pasajeros} pax</div>
 <div>${p.tipo}</div>
 <div>${new Date(p.horaRegistro).toLocaleTimeString()}</div>
 </body>`);
 w.print();w.close();
}

function exportarExcel(){
 const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(historial),"Historial");
 XLSX.writeFile(wb,"historial.xlsx");
}

function toggleDark(){
 dark=!dark;
 document.body.classList.toggle("dark");
 guardar();
}

render();
</script>

</body>
</html>
