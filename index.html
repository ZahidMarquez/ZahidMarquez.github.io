

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lista de Espera Interactiva</title>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: linear-gradient(135deg, #c7f0f9, #fdd6e3);
}

h2, h3 { text-align: center; }

input, button, select {
    margin: 5px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

button { cursor: pointer; font-weight: bold; }

ul { list-style: none; padding: 0; }

li {
    margin: 8px 0;
    padding: 10px;
    border-radius: 8px;
}

.aeromexico { background: #a8dadc; }
.platinum  { background: #d6cadd; }
.centurion { background: #ffd6a5; }

.btn-llamar { background: #90dbf4; border:none; margin-left:5px; }
.btn-stop   { background: #ffadad; border:none; margin-left:5px; }
.btn-retirado { background: #cccccc; border:none; margin-left:5px; }

.exportar { background: #bde0fe; }
.borrar   { background: #ffc8dd; }

#resumen{
    position: fixed;
    top: 15px;
    right: 15px;
    background: white;
    padding: 10px;
    border-radius: 10px;
    font-size: 13px;
    box-shadow: 0 4px 10px rgba(0,0,0,.2);
}
#resumen div{
    margin: 4px 0;
    font-weight: bold;
}

/* TICKET OCULTO */
#ticket {
    display: none;
    width: 250px; 
    padding: 10px; 
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    border-radius: 10px; 
    text-align: center;
}
#ticket img {
    width: 7cm;
    height: 7cm;
    margin-bottom:10px;
}
#ticket hr {
    border-top:1px dashed #000; 
    margin:10px 0;
}
#ticket p {
    margin:5px 0;
}
</style>
</head>
<body>

<!-- RESUMEN -->
<div id="resumen">
  <div id="res-centurion"></div>
  <div id="res-platinum"></div>
  <div id="res-aeromexico"></div>
</div>

<h2>ğŸ“‹ Lista de Espera âœˆï¸</h2>

<div style="text-align:center;">
<input type="text" id="nombre" placeholder="Nombre del pasajero">
<input type="number" id="pasajeros" placeholder="NÃºmero de pasajeros" min="1">
<select id="tipo">
  <option value="Aeromexico">Aeromexico</option>
  <option value="Platinum">Platinum</option>
  <option value="Centurion">Centurion</option>
</select><br>

<button id="btnAgregar">Agregar</button>
<button id="btnPantalla">ğŸ“º Pantalla</button>

<div>
<label><input type="checkbox" id="toggleTicket"> ğŸ–¨ï¸ Imprimir ticket</label>
</div>
</div>

<h3>â±ï¸ Tiempo estimado de espera</h3>
<div id="tiempoEspera" style="text-align:center;font-size:20px;font-weight:bold;">-- minutos</div>

<h3>Pasajeros en espera</h3>
<ul id="lista"></ul>

<h3>Historial</h3>

<button onclick="toggleHistorial('Centurion')">â• Centurion</button>
<ul id="historial-Centurion" style="display:none;"></ul>

<button onclick="toggleHistorial('Platinum')">â• Platinum</button>
<ul id="historial-Platinum" style="display:none;"></ul>

<button onclick="toggleHistorial('Aeromexico')">â• Aeromexico</button>
<ul id="historial-Aeromexico" style="display:none;"></ul>

<h3>Total personas: <span id="total">0</span></h3>

<div style="text-align:center;">
<button class="exportar" onclick="exportarExcel()">ğŸ’¾ Excel</button>
<button class="borrar" onclick="borrarHistorial()">ğŸ—‘ï¸ Borrar</button>
</div>

<audio id="sonidoLlamado" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<!-- TICKET OCULTO -->
<div id="ticket">
  <img src="https://cdn-icons-png.flaticon.com/256/5968/5968245.png" alt="Logo">
  <h3>ğŸ« Ticket de Registro</h3>
  <p><b>CÃ³digo:</b> <span id="ticketCodigo"></span></p>
  <p><b>Nombre:</b> <span id="ticketNombre"></span></p>
  <p><b>Pasajeros:</b> <span id="ticketPasajeros"></span></p>
  <p><b>Tipo:</b> <span id="ticketTipo"></span></p>
  <p><b>Hora:</b> <span id="ticketHora"></span></p>
  <hr>
  <p style="font-size:12px;">Gracias por su preferencia âœˆï¸</p>
</div>

<script>
// ================== JERARQUÃA ==================
const jerarquia = { Centurion:1, Platinum:2, Aeromexico:3 };

// ================== STORAGE ==================
let listaEspera = JSON.parse(localStorage.getItem("listaEspera")) || [];
let historial = JSON.parse(localStorage.getItem("historial")) || [];
let totalPersonas = Number(localStorage.getItem("totalPersonas")) || 0;
let codigoCounter = Number(localStorage.getItem("codigoCounter")) || 1;

// ================== INPUTS ==================
const nombreInput = document.getElementById("nombre");
const pasajerosInput = document.getElementById("pasajeros");
const tipoInput = document.getElementById("tipo");

document.getElementById("total").textContent = totalPersonas;

renderLista();
renderHistorial();
actualizarResumen();

// ================== TOGGLE HISTORIAL ==================
function toggleHistorial(tipo){
    const ul = document.getElementById(`historial-${tipo}`);
    ul.style.display = ul.style.display === "none" ? "block" : "none";
}

// ================== AGREGAR ==================
document.getElementById("btnAgregar").onclick = () => {
    const nombre = nombreInput.value.trim();
    const pasajeros = Number(pasajerosInput.value);
    const tipo = tipoInput.value;

    if (!nombre || pasajeros <= 0) {
        alert("Datos invÃ¡lidos");
        return;
    }

    const pasajero = {
        codigo: `AE-${String(codigoCounter++).padStart(4,"0")}`,
        nombre,
        pasajeros,
        tipo,
        horaRegistro: Date.now(),
        horaLlamado: null
    };

    listaEspera.push(pasajero);
    totalPersonas += pasajeros;

    guardar();
    renderLista();
    actualizarResumen();

    nombreInput.value = "";
    pasajerosInput.value = "";

    if (document.getElementById("toggleTicket").checked) {
        const ticketDiv = document.getElementById("ticket");
        switch(pasajero.tipo){
            case "Centurion": ticketDiv.style.border = "2px solid #ffd6a5"; break;
            case "Platinum": ticketDiv.style.border = "2px solid #d6cadd"; break;
            case "Aeromexico": ticketDiv.style.border = "2px solid #a8dadc"; break;
        }
        document.getElementById("ticketCodigo").textContent = pasajero.codigo;
        document.getElementById("ticketNombre").textContent = pasajero.nombre;
        document.getElementById("ticketPasajeros").textContent = pasajero.pasajeros;
        document.getElementById("ticketTipo").textContent = pasajero.tipo;
        document.getElementById("ticketHora").textContent = new Date(pasajero.horaRegistro).toLocaleTimeString();
        const ticketContent = ticketDiv.innerHTML;
        const newWin = window.open("", "_blank");
        newWin.document.write(`<html><head><title>Ticket</title></head><body style="text-align:center;">${ticketContent}</body></html>`);
        newWin.document.close();
        newWin.print();
    }
};

// ================== LLAMAR ==================
function llamarPasajero(codigo){
    const p = listaEspera.find(x => x.codigo === codigo);
    if (!p) return;
    p.horaLlamado = Date.now();
    document.getElementById("sonidoLlamado").play();

    const li = [...lista.children].find(li => li.textContent.includes(codigo));
    if(li){
        li.style.backgroundColor = "#fffa65";
        li.style.transition = "background-color 0.5s";
        setTimeout(() => {
            switch(p.tipo){
                case "Centurion": li.style.backgroundColor = "#ffd6a5"; break;
                case "Platinum": li.style.backgroundColor = "#d6cadd"; break;
                case "Aeromexico": li.style.backgroundColor = "#a8dadc"; break;
            }
        }, 1500);
    }
}

// ================== FINALIZAR ==================
function detenerLlamada(codigo){
    const idx = listaEspera.findIndex(p => p.codigo === codigo);
    if (idx < 0) return;

    const p = listaEspera.splice(idx, 1)[0];
    p.horaLlamado = p.horaLlamado || Date.now();
    p.retirado = false;

    historial.push(p);
    totalPersonas -= p.pasajeros;

    guardar();
    renderLista();
    renderHistorial();
    actualizarResumen();
}

// ================== RETIRADO ==================
function retirado(codigo){
    const idx = listaEspera.findIndex(p => p.codigo === codigo);
    if (idx < 0) return;

    const p = listaEspera.splice(idx, 1)[0];
    p.horaLlamado = p.horaLlamado || Date.now();
    p.retirado = true;

    historial.push(p);
    totalPersonas -= p.pasajeros;

    guardar();
    renderLista();
    renderHistorial();
    actualizarResumen();
}

// ================== RENDER LISTA ==================
function renderLista(){
    lista.innerHTML = "";
    [...listaEspera]
        .sort((a,b)=>jerarquia[a.tipo]-jerarquia[b.tipo] || a.horaRegistro-b.horaRegistro)
        .forEach(p=>{
            const li = document.createElement("li");
            li.className = p.tipo.toLowerCase();
            li.innerHTML = `<b>${p.codigo}</b> â€” ${p.nombre} (${p.pasajeros} pax)`;

            const b1 = document.createElement("button");
            b1.textContent = "Llamar";
            b1.className = "btn-llamar";
            b1.onclick = ()=>llamarPasajero(p.codigo);

            const b2 = document.createElement("button");
            b2.textContent = "Finalizar";
            b2.className = "btn-stop";
            b2.onclick = ()=>detenerLlamada(p.codigo);

            const b3 = document.createElement("button");
            b3.textContent = "Retirado";
            b3.className = "btn-retirado";
            b3.onclick = ()=>retirado(p.codigo);

            li.append(b1,b2,b3);
            lista.appendChild(li);
        });

    total.textContent = totalPersonas;
}

// ================== HISTORIAL ==================
function renderHistorial(){
    ["Centurion","Platinum","Aeromexico"].forEach(t=>{
        const ul = document.getElementById(`historial-${t}`);
        ul.innerHTML = "";
        historial.filter(h=>h.tipo===t).forEach(h=>{
            const li = document.createElement("li");
            li.textContent = `${h.codigo} â€” ${h.nombre} (${h.pasajeros} pax)${h.retirado?" (Retirado)":""}`;
            ul.appendChild(li);
        });
    });
    actualizarTiempo();
}

// ================== RESUMEN ==================
function actualizarResumen(){
    [["Centurion","CENT"],["Platinum","PLAT"],["Aeromexico","AERO"]]
    .forEach(([t,a])=>{
        const d = listaEspera.filter(p=>p.tipo===t);
        document.getElementById(`res-${t.toLowerCase()}`)
        .textContent = `${a} | ${d.length} | ${d.reduce((s,x)=>s+x.pasajeros,0)} pax`;
    });
}

// ================== TIEMPO ==================
function actualizarTiempo(){
    const tiempos = historial
        .filter(h=>h.horaLlamado)
        .map(h=>(h.horaLlamado-h.horaRegistro)/60000);

    tiempoEspera.textContent = tiempos.length 
        ? `${Math.round(tiempos.reduce((a,b)=>a+b,0)/tiempos.length)} minutos`
        : "0 minutos";
}

// ================== GUARDAR ==================
function guardar(){
    localStorage.setItem("listaEspera", JSON.stringify(listaEspera));
    localStorage.setItem("historial", JSON.stringify(historial));
    localStorage.setItem("totalPersonas", totalPersonas);
    localStorage.setItem("codigoCounter", codigoCounter);
}

// ================== FUNCIÃ“N FORMATEAR TIEMPO ==================
function formatoTiempo(ms){
    const totalSegundos = Math.floor(ms/1000);
    const h = Math.floor(totalSegundos/3600);
    const m = Math.floor((totalSegundos%3600)/60);
    const s = totalSegundos%60;
    return `${h}h ${m}m ${s}s`;
}

// ================== EXCEL ==================
function exportarExcel(){
    const wb = XLSX.utils.book_new();
    ["Centurion","Platinum","Aeromexico"].forEach(t=>{
        const d = historial
            .filter(h=>h.tipo===t)
            .map(h=>{
                const tiempoEspera = h.horaLlamado ? formatoTiempo(h.horaLlamado - h.horaRegistro) : "";
                return {
                    Codigo: h.codigo,
                    Nombre: h.nombre,
                    Pasajeros: h.pasajeros,
                    Tipo: h.tipo,
                    Retirado: h.retirado ? "SÃ­" : "No",
                    FechaRegistro: new Date(h.horaRegistro).toLocaleDateString(),
                    HoraRegistro: new Date(h.horaRegistro).toLocaleTimeString(),
                    FechaLlamado: h.horaLlamado ? new Date(h.horaLlamado).toLocaleDateString() : "",
                    HoraLlamado: h.horaLlamado ? new Date(h.horaLlamado).toLocaleTimeString() : "",
                    TiempoEspera: tiempoEspera
                }
            });

        if(d.length){
            XLSX.utils.book_append_sheet(
                wb,
                XLSX.utils.json_to_sheet(d),
                t
            );
        }
    });
    XLSX.writeFile(wb,"historial_completo.xlsx");
}

// ================== BORRAR ==================
function borrarHistorial(){
    if (confirm("Â¿Borrar historial?")) {
        historial = [];
        guardar();
        renderHistorial();
    }
}

// ================== PANTALLA ==================
document.getElementById("btnPantalla").onclick = () => {
    window.open("pantalla.html", "_blank");
};
</script>
</body>
</html>


